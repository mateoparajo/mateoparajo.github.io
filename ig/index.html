<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <!-- SEO & Meta Tags -->
  <title>Instagram â€“ mparajo448</title>
  <meta name="description" content="Perfil de Instagram de mparajo448" />
  <meta name="theme-color" content="#E4405F" />
  <meta name="robots" content="noindex, nofollow" />
  
  <!-- Open Graph (para compartir) -->
  <meta property="og:title" content="Instagram â€“ mparajo448" />
  <meta property="og:description" content="SÃ­gueme en Instagram" />
  <meta property="og:type" content="website" />
  
  <!-- Security Headers -->
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' https://www.googletagmanager.com; img-src 'self' https:; connect-src 'self' https://*.google-analytics.com https://*.analytics.google.com" />

  <!-- Preconnect para mejor rendimiento -->
  <link rel="preconnect" href="https://www.googletagmanager.com" />
  <link rel="preconnect" href="https://www.google-analytics.com" />
  <link rel="dns-prefetch" href="https://www.instagram.com" />

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-5EP61PTFRX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-5EP61PTFRX', { 
      anonymize_ip: true,
      allow_google_signals: false,
      allow_ad_personalization_signals: false
    });
  </script>

  <style>
    :root {
      --primary-color: #E4405F;
      --secondary-color: #405DE6;
      --tertiary-color: #5B51D8;
      --success-color: #31A24C;
      --text-primary: #262626;
      --text-secondary: #65676b;
      --bg-light: #F7F7F7;
      --border-color: #DBDBDB;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      height: 100%;
      scroll-behavior: smooth;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif;
      color: var(--text-primary);
      font-size: 16px;
      line-height: 1.5;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      padding: 48px 32px;
      max-width: 360px;
      width: 100%;
      text-align: center;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header {
      margin-bottom: 32px;
    }

    .icon {
      width: 64px;
      height: 64px;
      margin: 0 auto 20px;
      background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }

    .loader {
      width: 48px;
      height: 48px;
      border: 4px solid var(--bg-light);
      border-top: 4px solid var(--primary-color);
      border-right: 4px solid var(--secondary-color);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    h1 {
      font-size: 28px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 24px;
      line-height: 1.6;
    }

    .info-box {
      background: var(--bg-light);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
      font-size: 13px;
      color: var(--text-secondary);
    }

    .info-box strong {
      color: var(--text-primary);
      display: block;
      margin-bottom: 4px;
    }

    .status {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--success-color);
      margin-top: 16px;
    }

    .status::before {
      content: '';
      width: 8px;
      height: 8px;
      background: var(--success-color);
      border-radius: 50%;
      animation: blink 1s ease-in-out infinite;
    }

    @keyframes blink {
      0%, 49%, 100% { opacity: 1; }
      50%, 99% { opacity: 0.3; }
    }

    /* Fallback para sin JS */
    noscript .container {
      animation: none;
    }

    noscript h1 {
      font-size: 24px;
    }

    noscript p {
      margin-bottom: 24px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    noscript a {
      display: inline-block;
      background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
      color: white;
      padding: 12px 32px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      transition: var(--transition);
      box-shadow: 0 4px 12px rgba(227, 64, 95, 0.3);
    }

    noscript a:active {
      transform: scale(0.98);
    }

    @media (max-width: 480px) {
      body {
        padding: 16px;
      }

      .container {
        padding: 36px 24px;
      }

      h1 {
        font-size: 24px;
      }

      .icon {
        width: 56px;
        height: 56px;
        font-size: 28px;
      }

      .loader {
        width: 40px;
        height: 40px;
      }
    }

    /* Modo oscuro */
    @media (prefers-color-scheme: dark) {
      body {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      }

      .container {
        background: #262626;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      h1 {
        color: white;
      }

      .subtitle, .info-box {
        color: #b0b0b0;
      }

      .info-box {
        background: #333;
        border-color: #404040;
      }

      .info-box strong {
        color: #e0e0e0;
      }
    }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="icon">ðŸ“±</div>
      <div class="loader"></div>
      <h1>Redirigiendo...</h1>
      <p class="subtitle">Te llevaremos a Instagram en un momento</p>
    </div>

    <div class="info-box">
      <strong>ðŸ‘¤ mparajo448</strong>
      SÃ­gueme en Instagram
    </div>

    <div class="status">Conectando</div>
  </div>

  <!-- Fallback para navegadores sin JavaScript -->
  <noscript>
    <div class="container">
      <h1>ðŸ“± Instagram</h1>
      <p>Si no eres redirigido automÃ¡ticamente,</p>
      <a href="https://www.instagram.com/mparajo448/">abre Instagram aquÃ­</a>
    </div>
  </noscript>

  <script>
    // ConfiguraciÃ³n centralizada
    const CONFIG = {
      instagram: {
        username: "mparajo448",
        baseUrl: "https://www.instagram.com"
      },
      analytics: {
        enabled: true,
        defaultSource: "direct"
      },
      timing: {
        redirectDelay: 300, // ms - tiempo para registrar analytics
        redirectTimeout: 8000, // ms - timeout de seguridad
        analyticsTimeout: 500 // ms - timeout para esperar analytics
      },
      features: {
        validateUrl: true,
        logErrors: true,
        debugMode: false
      }
    };

    class InstagramRedirector {
      constructor(config) {
        this.config = config;
        this.redirected = false;
        this.analyticsReady = false;
        this.startTime = performance.now();
      }

      /**
       * Obtener parÃ¡metro de query de forma segura
       */
      getQueryParam(name) {
        try {
          const params = new URLSearchParams(window.location.search);
          const value = params.get(name);
          
          // Validar que el valor sea seguro
          if (!value) return null;
          
          const trimmed = value.trim();
          
          // Solo permitir caracteres alfanumÃ©ricos, guiones y guiones bajos
          if (!/^[a-zA-Z0-9_-]{1,50}$/.test(trimmed)) {
            this.log(`ParÃ¡metro rechazado: ${name} contiene caracteres invÃ¡lidos`, 'warn');
            return null;
          }
          
          return trimmed;
        } catch (error) {
          this.log(`Error al obtener parÃ¡metro ${name}:`, error, 'error');
          return null;
        }
      }

      /**
       * Validar URL antes de redirigir
       */
      validateUrl(url) {
        try {
          const parsedUrl = new URL(url);
          const isValid = parsedUrl.protocol === 'https:' && 
                          parsedUrl.hostname === this.config.instagram.baseUrl.replace('https://', '');
          
          if (!isValid && this.config.features.validateUrl) {
            this.log('URL no vÃ¡lida detectada', 'warn');
            return false;
          }
          
          return true;
        } catch (error) {
          this.log('Error validando URL:', error, 'error');
          return false;
        }
      }

      /**
       * Registrar evento en Analytics
       */
      trackEvent(source) {
        if (!this.config.analytics.enabled || typeof gtag === 'undefined') {
          this.analyticsReady = true;
          return Promise.resolve();
        }

        return new Promise((resolve) => {
          try {
            // Obtener informaciÃ³n adicional
            const referrer = document.referrer || 'direct';
            const timestamp = new Date().toISOString();

            gtag("event", "qr_open", {
              src: source,
              username: this.config.instagram.username,
              page_path: location.pathname,
              page_location: location.href,
              referrer: referrer,
              timestamp: timestamp,
              device_type: this.getDeviceType(),
              browser_language: navigator.language,
              screen_resolution: `${screen.width}x${screen.height}`
            });

            // Esperar a que analytics se envÃ­e (con timeout)
            const timeoutId = setTimeout(() => {
              this.analyticsReady = true;
              resolve();
            }, this.config.timing.analyticsTimeout);

            // Si analytics se envÃ­a antes, resolver antes
            window.addEventListener('beforeunload', () => {
              clearTimeout(timeoutId);
              this.analyticsReady = true;
              resolve();
            }, { once: true });

          } catch (error) {
            this.log('Error en analytics:', error, 'error');
            this.analyticsReady = true;
            resolve();
          }
        });
      }

      /**
       * Detectar tipo de dispositivo
       */
      getDeviceType() {
        const ua = navigator.userAgent;
        if (/mobile|android|iphone|ipad|phone/i.test(ua)) return 'mobile';
        if (/tablet|ipad/i.test(ua)) return 'tablet';
        return 'desktop';
      }

      /**
       * Logging con control de debug
       */
      log(message, data = '', level = 'info') {
        if (!this.config.features.logErrors) return;

        const timestamp = `[${new Date().toLocaleTimeString()}]`;
        const prefix = `IGRedirector ${timestamp}`;

        switch (level) {
          case 'error':
            console.error(`${prefix} âŒ`, message, data);
            break;
          case 'warn':
            console.warn(`${prefix} âš ï¸`, message, data);
            break;
          case 'info':
            console.log(`${prefix} â„¹ï¸`, message, data);
            break;
          case 'debug':
            if (this.config.features.debugMode) {
              console.log(`${prefix} ðŸ›`, message, data);
            }
            break;
        }
      }

      /**
       * Realizar redirecciÃ³n
       */
      async redirect(profileUrl) {
        if (this.redirected) return;

        this.redirected = true;
        const elapsed = performance.now() - this.startTime;

        try {
          this.log(`Redirigiendo a ${profileUrl} (${elapsed.toFixed(2)}ms)`);
          
          // Usar replace para no agregar al historial
          window.location.replace(profileUrl);

          // Failsafe: si replace no funciona, usar href
          setTimeout(() => {
            if (!this.redirected) {
              window.location.href = profileUrl;
            }
          }, 500);

        } catch (error) {
          this.log('Error en redirecciÃ³n:', error, 'error');
          // Fallback final
          window.location.href = profileUrl;
        }
      }

      /**
       * Inicializar el redirector
       */
      async init() {
        try {
          this.log('Inicializando redirector', '');
          
          // Obtener parÃ¡metros
          const source = this.getQueryParam('src') || this.config.analytics.defaultSource;
          const profileUrl = `${this.config.instagram.baseUrl}/${this.config.instagram.username}/`;

          // Validar URL
          if (!this.validateUrl(profileUrl)) {
            throw new Error('URL de perfil no vÃ¡lida');
          }

          this.log(`Fuente de trÃ¡fico: ${source}`);

          // Registrar evento de analytics
          await this.trackEvent(source);

          // Esperar el delay mÃ­nimo antes de redirigir
          await new Promise(resolve => 
            setTimeout(resolve, this.config.timing.redirectDelay)
          );

          // Redirigir
          await this.redirect(profileUrl);

          // Timeout de seguridad
          setTimeout(() => {
            if (!this.redirected) {
              this.log('Timeout de redirecciÃ³n alcanzado, forzando redirecciÃ³n', '', 'warn');
              window.location.href = profileUrl;
            }
          }, this.config.timing.redirectTimeout);

        } catch (error) {
          this.log('Error fatal:', error, 'error');
          // En caso de error, redirigir igualmente
          await this.redirect(`${this.config.instagram.baseUrl}/${this.config.instagram.username}/`);
        }
      }
    }

    // Ejecutar cuando el DOM estÃ© listo
    function initializeApp() {
      const redirector = new InstagramRedirector(CONFIG);
      redirector.init();
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
      initializeApp();
    }

    // Monitoreo de errores no capturados
    window.addEventListener('error', (event) => {
      console.error('Error no capturado:', event.error);
    });

    // Monitoreo de promesas rechazadas
    window.addEventListener('unhandledrejection', (event) => {
      console.error('Promesa rechazada:', event.reason);
    });
  </script>
</body>
</html>